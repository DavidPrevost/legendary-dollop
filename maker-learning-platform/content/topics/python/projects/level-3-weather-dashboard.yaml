id: py-level-3-weather-dashboard
name: Weather Dashboard
subject: python
level: 3
level_name: Builder

description: |
  Build a CLI tool that fetches weather data from a public API.
  Displays current conditions with caching and error handling.

estimated_time: 120-180 minutes

learning_objectives:
  - Make HTTP requests to APIs
  - Parse JSON responses
  - Implement error handling for network issues
  - Add caching to reduce API calls
  - Use argparse for CLI

prerequisites:
  concepts:
    - HTTP requests
    - JSON parsing
    - Error handling
    - File I/O for caching
    - argparse
    - Logging
  tools:
    - Python 3.x installed
    - requests library

deliverables:
  - name: weather.py
    description: Main weather CLI
    type: file

  - name: config.py
    description: API configuration
    type: file

  - name: cache/
    description: Cache directory
    type: directory

requirements:
  - id: fetch_weather
    description: Fetches weather from API
    validation:
      type: function_exists
      function: fetch_weather

  - id: display_current
    description: Displays current conditions
    validation:
      type: function_exists
      function: display_current

  - id: caching
    description: Caches results to reduce API calls
    validation:
      type: function_exists
      function: get_cached_or_fetch

  - id: error_handling
    description: Handles network errors gracefully
    validation:
      type: manual
      criteria: No crashes on network failure

  - id: cli_args
    description: Uses argparse for city input
    validation:
      type: module_used
      module: argparse

starter_code:
  - name: weather.py
    content: |
      """Weather Dashboard

      Fetches and displays weather information from API.
      """

      import argparse
      import json
      import logging
      from datetime import datetime
      from pathlib import Path

      try:
          import requests
      except ImportError:
          print("Please install requests: pip install requests")
          exit(1)

      from config import API_KEY, BASE_URL

      # Setup logging
      logging.basicConfig(
          level=logging.INFO,
          format='%(asctime)s - %(levelname)s - %(message)s'
      )
      logger = logging.getLogger(__name__)

      CACHE_DIR = Path("cache")
      CACHE_DURATION = 600  # 10 minutes

      def fetch_weather(city):
          """Fetch weather data from API."""
          # Your code here
          pass

      def get_cached_or_fetch(city):
          """Return cached data if fresh, otherwise fetch new."""
          # Your code here
          pass

      def display_current(data):
          """Display current weather conditions."""
          # Your code here
          pass

      def main():
          """Main entry point."""
          parser = argparse.ArgumentParser(description='Weather Dashboard')
          parser.add_argument('city', help='City name')
          parser.add_argument('-v', '--verbose', action='store_true')

          args = parser.parse_args()

          if args.verbose:
              logger.setLevel(logging.DEBUG)

          try:
              data = get_cached_or_fetch(args.city)
              display_current(data)
          except Exception as e:
              logger.error(f"Error: {e}")
              print(f"Could not get weather for {args.city}")

      if __name__ == "__main__":
          main()

  - name: config.py
    content: |
      """Weather API configuration.

      Sign up at https://openweathermap.org/api for a free API key.
      """

      API_KEY = "your_api_key_here"
      BASE_URL = "https://api.openweathermap.org/data/2.5/weather"

api_notes: |
  This project uses OpenWeatherMap API (free tier available).
  Alternative free APIs:
  - WeatherAPI.com
  - Open-Meteo (no key required)

hints:
  - level: 1
    text: Use requests.get() with params dict for query parameters

  - level: 2
    text: Cache using JSON files with timestamp in the data

  - level: 3
    text: Use try/except around requests.get() for network errors

extensions:
  - Add 5-day forecast
  - Support multiple units (Celsius/Fahrenheit)
  - Add weather alerts
  - Create simple GUI with tkinter

reflection_questions:
  - How long should weather data be cached?
  - What happens when the API is unavailable?
  - How would you add support for location by coordinates?
